language: python
python:
- pypy
- '3.6'
- '3.5'
- '2.7'
- '3.4'
- '3.3'
- pypy3.3-5.2-alpha1
- '2.6'
env:
- ADMESH=0.98.2
- ADMESH=0.98.1
cache:
  directories:
  - $HOME/.cache/pip
  - $HOME/build/admesh/python-admesh/admesh-$ADMESH
  - .eggs
  - .tox
before_install:
- if [ ! -f admesh-$ADMESH/.libs/admesh ]; then
      wget https://github.com/admesh/admesh/releases/download/v$ADMESH/admesh-$ADMESH.tar.gz;
      tar -zxf admesh-$ADMESH.tar.gz;
      cd admesh-$ADMESH;
      "./configure";
      make;
      mkdir src/admesh;
      cp src/stl.h src/admesh/stl.h;
      cd ..;
  fi
install:
- pip install tox-travis
script: LD_LIBRARY_PATH=$PWD/admesh-$ADMESH/.libs LDFLAGS=-L$PWD/admesh-$ADMESH/.libs CFLAGS=-I$PWD/admesh-$ADMESH/src tox
deploy:
  provider: pypi
  user: hroncok
  password:
    secure: KAJOtf4HDXzL1LQsqGVPoHPniLcGcSwHvtp6gyiLUFwKmhIoqd7+ONSCVfDBCuIysOcsyXHGt1piMrMgyvuykupnFu43MDatWYk9KqaBs6/gyhoI/Ha7tavAiTMlaToEyNQGh7K6FZoVbVpEELtnuytRkWPqGfNTonEpWnmWMKw=
  on:
    tags: true
    repo: admesh/python-admesh
    python: pypy
